<!doctype html>
<html lang="en-us">
  <body>
<canvas id="canvas"></canvas>
<script>
    var canvas = document.getElementById("canvas");
    var context = canvas.getContext("2d");
    canvas.width = 640;
    canvas.height = 853;
    var img = new Image();
    img.src = "t1.jpg";
    img.onload =function()
	{
        invert(this);
    };
    //    像素点的rgba数组
    function invert(img) 
	{
        /*context.drawImage(img,0,0);
        //获取图片对象以及元素点的数组
        var img1 = context.getImageData(0, 0, 800, 800);
        var data = img1.data;
        //反转rgba
        for (var i = 0, len = data.length; i < len; i += 4 
		{
			var avg=(data[i]+data[i+1]+data[i+2])/3;
			data[i]=avg;
			data[i+1]=avg;
			data[i+2]=avg
        }
        context.putImageData(img1, 0, 0);*/
		
		context.drawImage(img,0,0);
		//获取图片对象以及元素点的数组
		var img1 = context.getImageData(0, 0, 640, 853);
		var data = img1.data;
		//转换灰度图
		var arr=["1","2","3","4","5","6","7","8","9",",",",",",",",",".",".","."];
		var result=[];
		for (var i = 0, len = data.length; i < len; i += 4) {
			//var avg=(data[i]+data[i+1]+data[i+2])/3;
			var avg=(data[i]*0.3+data[i+1]*0.59+data[i+2]*0.11);
			var num=Math.floor(avg/18);
			result.push(arr[num]);
			if(i%2560==0&&i!=0){
				result.push("<br>")
			}
		}
		var opt=document.getElementById("inner");
		opt.innerHTML=result.join();
		//document.body.appendChild(opt);
    }
</script>
</script>
<div id='inner' style="font-size:5px;word-spacing:10px;line-height:6px;" ></div>
  </body>
</html>
